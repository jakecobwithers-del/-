<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Acres Panel — Shop</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#0f0f11; --panel:#121214; --muted:#9aa0a6; --accent:#e63946; --glass: rgba(255,255,255,0.03);
    --card:#0f1113; --success:#2ecc71; --danger:#ff6b6b;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#060607 0%,#0f0f11 100%);color:#e8eef1;padding:2rem;}
  .wrap{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:2rem}
  /* Admin panel */
  .panel{background:var(--panel);padding:1.25rem;border-radius:12px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 6px 30px rgba(0,0,0,0.6)}
  h1{font-size:18px;margin:0 0 12px 0;font-weight:800;letter-spacing:0.6px}
  label{display:block;font-size:13px;color:var(--muted);margin-top:10px}
  input[type="text"], input[type="number"], textarea, select{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:#fff;margin-top:6px}
  textarea{min-height:80px;resize:vertical}
  .row{display:flex;gap:8px}
  .btn{display:inline-block;background:var(--accent);color:#fff;padding:10px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:600}
  .btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
  .small{font-size:13px;padding:8px 10px}
  .uploads-preview{display:grid;grid-template-columns:1fr;gap:8px;margin-top:12px}
  .preview{width:100%;height:160px;border-radius:8px;object-fit:cover;background:#09090a;border:1px dashed rgba(255,255,255,0.03)}
  .meta{font-size:12px;color:var(--muted);margin-top:8px}

  /* Storefront */
  .store{display:grid;grid-template-columns:1fr 1fr;gap:1.25rem}
  .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);display:flex;flex-direction:column}
  .card img{width:100%;height:180px;object-fit:cover;border-radius:8px}
  .card h3{margin:10px 0 6px 0;font-size:16px}
  .price{font-weight:700;color:#fff}
  .muted{color:var(--muted);font-size:13px}
  .badges{display:flex;gap:8px;align-items:center;margin-top:8px}
  .badge{padding:6px 8px;border-radius:8px;font-size:12px;background:rgba(255,255,255,0.03);color:var(--muted)}
  .stock-low{background:linear-gradient(90deg,#33221a, #3b1f1f);color:#ffddcc}
  .controls{display:flex;gap:8px;margin-top:10px}
  .controls .btn{flex:1}

  /* utilities */
  .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .search{width:320px;padding:8px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:#fff}
  .full{grid-column:1/-1}
  footer{margin-top:1rem;color:var(--muted);font-size:13px;text-align:center}
  @media (max-width:980px){.wrap{grid-template-columns:1fr;}.store{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="wrap">
  <aside class="panel" aria-labelledby="adminTitle">
    <h1 id="adminTitle">Admin Upload Panel</h1>

    <label>Title</label>
    <input id="title" type="text" placeholder="Item title e.g., Rusted Ammo Crate">

    <label>Price (AUD)</label>
    <input id="price" type="number" step="0.01" placeholder="49.00">

    <label>Stock</label>
    <input id="stock" type="number" min="0" placeholder="12">

    <label>Short description</label>
    <textarea id="desc" placeholder="One-line description"></textarea>

    <label>Image (jpg, png) — preview shows local upload</label>
    <input id="image" type="file" accept="image/*">

    <div class="meta">Max local persistence: <strong>localStorage</strong>. Use export to move data to GitHub or a backend later.</div>

    <div style="margin-top:12px;" class="row">
      <button class="btn" id="uploadBtn">Upload Listing</button>
      <button class="btn ghost small" id="clearBtn">Clear form</button>
    </div>

    <div style="margin-top:12px;" class="row">
      <button class="btn ghost small" id="exportJson">Export JSON</button>
      <button class="btn ghost small" id="exportCsv">Export CSV</button>
    </div>

    <div class="meta" style="margin-top:14px">Tips: commit exported JSON to GitHub, hook a tiny backend (Firebase/Netlify Function) for real hosting, or use Shopify theme integration to deploy storefront assets.</div>
  </aside>

  <main>
    <div class="panel" style="margin-bottom:1rem;">
      <div class="topbar">
        <div>
          <h1 style="font-size:16px;margin:0">Storefront</h1>
          <div class="muted">Manage listings and preview live</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="q" class="search" placeholder="Search title or description">
          <button id="newListingBtn" class="btn ghost small">New listing</button>
        </div>
      </div>

      <div id="listCount" class="muted" style="margin-bottom:8px">0 items</div>

      <div id="storeGrid" class="store"></div>
    </div>

    <div class="panel">
      <h1 style="font-size:16px;margin:0 0 10px 0">Cart (demo)</h1>
      <div id="cart" class="muted">Cart is empty</div>
      <div style="margin-top:12px">
        <button id="clearAll" class="btn ghost small">Delete all listings</button>
      </div>
    </div>
  </main>
</div>

<footer>Single-file shop • Local storage demo • Export to move into GitHub</footer>

<script>
/* ========== Data model & persistence ========== */
const LS_KEY = 'acres_listings_v1';
let listings = JSON.parse(localStorage.getItem(LS_KEY) || '[]');

/* Utility: save */
function saveListings(){ localStorage.setItem(LS_KEY, JSON.stringify(listings)); renderStore(); }

/* ========== DOM refs ========== */
const titleEl = document.getElementById('title');
const priceEl = document.getElementById('price');
const stockEl = document.getElementById('stock');
const descEl = document.getElementById('desc');
const imageEl = document.getElementById('image');
const uploadBtn = document.getElementById('uploadBtn');
const clearBtn = document.getElementById('clearBtn');
const storeGrid = document.getElementById('storeGrid');
const listCount = document.getElementById('listCount');
const exportJson = document.getElementById('exportJson');
const exportCsv = document.getElementById('exportCsv');
const q = document.getElementById('q');
const clearAll = document.getElementById('clearAll');

/* ========== Helpers ========== */
function uid(){ return 'id_' + Math.random().toString(36).slice(2,9); }
function formatPrice(n){ return new Intl.NumberFormat('en-AU',{style:'currency',currency:'AUD'}).format(n); }

/* ========== Image handling: read as data URL so items persist locally ========== */
function readImageFile(file){
  return new Promise((res, rej) => {
    if(!file) return res(null);
    const r = new FileReader();
    r.onload = ()=>res(r.result);
    r.onerror = ()=>rej('read error');
    r.readAsDataURL(file);
  });
}

/* ========== Render store ========== */
function renderStore(){
  const qv = q.value.trim().toLowerCase();
  const filtered = listings.filter(it => {
    if(!qv) return true;
    return (it.title + ' ' + it.description).toLowerCase().includes(qv);
  });

  storeGrid.innerHTML = '';
  listCount.textContent = `${filtered.length} items`;

  if(filtered.length === 0){
    storeGrid.innerHTML = '<div class="muted">No items yet. Use the Admin Upload Panel to add listings.</div>';
    return;
  }

  filtered.forEach(item => {
    const card = document.createElement('div'); card.className = 'card';
    card.innerHTML = `
      <div style="position:relative">
        <img src="${item.image || placeholderData(item.title)}" alt="${escapeHtml(item.title)}">
      </div>
      <h3>${escapeHtml(item.title)}</h3>
      <div class="muted">${escapeHtml(item.description)}</div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
        <div>
          <div class="price">${formatPrice(item.price)}</div>
          <div class="muted">SKU: ${item.id}</div>
        </div>
        <div class="badges">
          <div class="badge ${item.stock <= 3 ? 'stock-low' : ''}">Stock: ${item.stock}</div>
        </div>
      </div>
      <div class="controls">
        <button class="btn" data-action="buy" data-id="${item.id}">Add to cart</button>
        <button class="btn ghost small" data-action="edit" data-id="${item.id}">Edit</button>
        <button class="btn ghost small" data-action="delete" data-id="${item.id}">Delete</button>
      </div>
    `;
    storeGrid.appendChild(card);
  });

  // attach events (delegation would be fine; we attach per item for clarity)
  storeGrid.querySelectorAll('button[data-action]').forEach(btn=>{
    btn.onclick = () => {
      const action = btn.dataset.action;
      const id = btn.dataset.id;
      if(action === 'buy') addToCart(id);
      if(action === 'edit') beginEdit(id);
      if(action === 'delete') removeItem(id);
    };
  });
}

/* ========== Placeholder image generator (simple SVG data url) ========== */
function placeholderData(text){ 
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='800' height='500'><rect width='100%' height='100%' fill='#111'/><text x='50%' y='50%' fill='#666' font-size='24' dominant-baseline='middle' text-anchor='middle' font-family='Inter, Arial'>${escapeHtml(text||'No image')}</text></svg>`;
  return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
}

/* ========== CRUD operations ========== */
async function uploadListing(editId){
  const title = titleEl.value.trim();
  const price = parseFloat(priceEl.value) || 0;
  const stock = parseInt(stockEl.value) || 0;
  const description = descEl.value.trim();
  const file = imageEl.files[0];

  if(!title){ alert('Enter a title'); return; }
  if(price <= 0){ if(!confirm('Price is zero or invalid. Continue?')) return; }

  const imgData = await readImageFile(file);

  if(editId){
    const idx = listings.findIndex(x=>x.id === editId);
    if(idx === -1) return alert('Item not found');
    listings[idx] = Object.assign({}, listings[idx], {title, price, stock, description, image: imgData || listings[idx].image});
  } else {
    const item = { id: uid(), title, price, stock, description, image: imgData || null, createdAt: Date.now() };
    listings.unshift(item);
  }

  saveListings();
  resetForm();
}

function resetForm(){
  titleEl.value=''; priceEl.value=''; stockEl.value=''; descEl.value=''; imageEl.value='';
  uploadBtn.textContent = 'Upload Listing';
  uploadBtn.dataset.edit = '';
}

function beginEdit(id){
  const it = listings.find(x=>x.id===id);
  if(!it) return alert('Listing not found');
  titleEl.value = it.title;
  priceEl.value = it.price;
  stockEl.value = it.stock;
  descEl.value = it.description;
  uploadBtn.textContent = 'Save Changes';
  uploadBtn.dataset.edit = id;
  window.scrollTo({top:0,behavior:'smooth'});
}

function removeItem(id){
  if(!confirm('Delete this listing?')) return;
  listings = listings.filter(x=>x.id!==id);
  saveListings();
}

function addToCart(id){
  const it = listings.find(x=>x.id===id);
  if(!it) return;
  alert(`Added "${it.title}" to cart (demo).`);
}

/* ========== Export / Import ========== */
exportJson.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(listings, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'listings.json'; a.click(); URL.revokeObjectURL(url);
});

exportCsv.addEventListener('click', ()=>{
  if(listings.length===0){ alert('No items'); return; }
  const header = ['id','title','price','stock','description','imageDataURL'];
  const rows = listings.map(it => header.map(h => `"${(it[h]||'').toString().replace(/"/g,'""')}"`).join(','));
  const csv = [header.join(','), ...rows].join('\n');
  const blob = new Blob([csv], {type:'text/csv'}); const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='listings.csv'; a.click(); URL.revokeObjectURL(url);
});

/* ========== Events ========== */
uploadBtn.addEventListener('click', ()=> uploadListing(uploadBtn.dataset.edit || '') );
clearBtn.addEventListener('click', resetForm);
q.addEventListener('input', renderStore);
clearAll.addEventListener('click', ()=> {
  if(!confirm('Delete ALL listings? This is permanent for localStorage.')) return;
  listings = []; saveListings();
});

/* ========== small helpers ========== */
function escapeHtml(s){ return (s+'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }

/* ========== Init render ========== */
renderStore();

/* ========== Optional: import from JSON file (developer convenience) ========== */
/* Uncomment and add a file input in the DOM if you want to import json files into localStorage */

/*
const importBtn = document.createElement('button');
importBtn.textContent='Import JSON';
importBtn.className='btn ghost small';
importBtn.onclick = async () => {
  const input = document.createElement('input'); input.type='file'; input.accept='application/json';
  input.onchange = async ()=> {
    const f = input.files[0]; if(!f) return;
    const txt = await f.text(); try{ const arr = JSON.parse(txt); if(Array.isArray(arr)){ listings = arr; saveListings(); alert('Imported'); }else alert('Invalid JSON'); }catch(e){ alert('Parse error'); }
  };
  input.click();
};
document.querySelector('aside.panel').appendChild(importBtn);
*/

</script>
</body>
</html>
